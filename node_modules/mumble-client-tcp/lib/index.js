'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _promise = require('promise');

var _promise2 = _interopRequireDefault(_promise);

var _tls = require('tls');

var _tls2 = _interopRequireDefault(_tls);

var _mumbleClient = require('mumble-client');

var _mumbleClient2 = _interopRequireDefault(_mumbleClient);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function connect(host, port, options, callback) {
  var tlsOptions = options.tls || {};
  var rejectUnauthorized = 'rejectUnauthorized' in tlsOptions ? tlsOptions.rejectUnauthorized : true;
  return new _promise2.default(function (resolve, reject) {
    var socket = _tls2.default.connect(port, host, tlsOptions).on('error', reject).on('secureConnect', function () {
      if (socket.authorized || !rejectUnauthorized) {
        resolve(socket);
      } else {
        reject(socket.authorizationError);
      }
    });
  }).then(function (socket) {
    return new _mumbleClient2.default(options).connectDataStream(socket);
  }).nodeify(callback);
}

exports.default = connect;